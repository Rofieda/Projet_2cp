<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width , initial-scale=1.0">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">

        <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href='https://fonts.googleapis.com/css?family=Fjalla One' rel='stylesheet'>
        <link rel="stylesheet" href="../styles/VoirProfilAssisstant.css">
        <link rel="stylesheet" href="../styles/BARS.css">
        
        <title>Lmcs Quest</title>
    </head>
<body>


   <script src="../javascript/BARS.js"></script>
   <script src="../javascript/BARSAdmin.js"></script>
   <script src="../javascript/notificationadmin.js"></script>


    <div class="tiiitre">
        <img class="iconnn" src="../images/Profile 1.png"><h1 class="title-profil"> Information personnelle et professionnel</h1>
    </div>


   <div class="cart">
           <div class="pictureee"><img class="piic" src="../images/user profil.png" ></div>
           <div class="vertical-line"></div>
           <div class="Informationnn">
            <table class="tab-info">
                <tr class="naame">
                    <td>Nom :</td>
                    <td><span id="user-lastname">[Contenu de la colonne]</span></td>
                </tr>
                <tr class="naame2">
                    <td>Prénom :</td>
                    <td><span id="user-firstname">[Contenu de la colonne]</span></td>
                </tr>
                <tr class="maail">
                    <td>Email :</td>
                    <td><span id="user-email">[Contenu de la colonne]</span></td>
                </tr>
                <tr class="roole">
                    <td>Rôle :</td>
                     <td><span id="user-role">[Contenu de la colonne]</span></td>
                </tr>
                <tr class="statuus">
                    <td>Status :</td>
                    <td><span id="user-status">[Contenu de la colonne]</span></td>
                </tr>


            </table>
           </div>  
   </div>















        <div class="security">
            <div class="security-title">
                <img src="../images/lock 3.png" alt="icône de sécurité">
                <p>Mot de passe et Sécurité</p>
            </div>

            <div class="password-input">
                <label for="password">Mot de passe :</label>
                <p>Pour modifier le mot de passe cliquer sur modifer</p>
                <button class="modify-button"><img src="../images/Edit 1.png">Modifier</button>
                <div class="forgot-password">
                    <span id="overlay"></span>
                    <div id="modal" class="modal">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <h3 id="forgot-password-title">Changement de mot de passe:</h3>
                            <input id="reset-email" name="email" placeholder="Votre adresse e-mail" type="email">
                            <span class="reset-email-info">Un email vous sera envoyé pour réinitialiser votre mot de passe</span>
                            <div id="reset-email-error" class="error-message"></div>
                            <button id="reset-password-btn">Réinitialiser votre mot de passe</button>
                        </div>
                    </div>
                </div>
                <div class="forgot-password">
                    <span id="overlay"></span>
                    <div id="modal-red-password" class="modal modal-large">
                        <div class="modal-content">
                            <h3 id="red-password-title">Redéfinition de votre mot de passe</h3>
                            <div class="password-container">
                                <input id="new-password" name="new-password" placeholder="Nouveau mot de passe" type="password">
                                <span class="toggle-password2">
                                    <img src="../images/hide.png" class="icon2 visible" alt="Icône password visible">
                                </span>
                                <span class="error-message" id="new-password-error"></span>
                                <input id="confirm-new-password" name="confirm-new-password"
                                    placeholder="Confirmer le nouveau mot de passe" type="password">
                                <span class="toggle-password2">
                                    <img src="../images/hide.png" class="icon2 visible" alt="Icône password visible">
                                </span>
                                <span class="error-message" id="confirm-new-password-error"></span>
                                <div>
                                    <input class="reset-email" id="uidb64" name="uidb64" placeholder="Code de confirmation" type="text">
                                    <input class="reset-email" id="token" name="token" placeholder="Code d'autorisation" type="text">
                                </div>
                            </div>
                            <div class="button-container">
                                <button id="red-password-btn"
                                    onclick="applyChange('Votre mot de passe a été modifié avec succès !')">Enregistrer</button>
                                <button id="cancel-reset-btn">Annuler</button>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
        </div>
        <div id="mess" class="popup">
            <p><img src="../images/appliquer.png">Vos Informations ont été <br>modifié avec succès !</p>
        </div>

<script src="../javascript/infosluimeme.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    // Appeler la fonction pour récupérer les informations de l'utilisateur lors du chargement de la page
    fetchUserInformation();

    function fetchUserInformation() {
        // Récupérer l'ID de l'utilisateur à partir du stockage de session
        var userInfo = JSON.parse(sessionStorage.getItem('user_info'));
        var userId = userInfo.id;

        // Effectuer une requête pour récupérer les informations de l'utilisateur
        fetch('http://127.0.0.1:8000/api/v1/auth/user/' + userId + '/')
            .then(response => response.json())
            .then(data => {
                // Mettre à jour les éléments HTML avec les informations de l'utilisateur récupérées
                document.getElementById('user-lastname').textContent = data.last_name;
                document.getElementById('user-firstname').textContent = data.first_name;
                document.getElementById('user-email').textContent = data.email;
                document.getElementById('user-role').textContent = data.role;
                document.getElementById('user-status').textContent = data.is_active_display;
            })
            .catch(error => console.error('Erreur lors de la récupération des informations de l\'utilisateur :', error));
    }
});

function resetPassword() {
    // Récupérer l'email de réinitialisation
    const resetEmail = document.getElementById('reset-email').value.trim();


    // Envoyer une requête AJAX au backend pour réinitialiser le mot de passe
    $.ajax({
        url: 'http://127.0.0.1:8000/api/v1/auth/password-reset/',
        method: 'POST',

        data: { email: resetEmail },
        success: function (response) {
            // Afficher un message de succès ou rediriger l'utilisateur
            console.log('Mot de passe réinitialisé avec succès !');

            // Rediriger vers la page de confirmation ou afficher la fenêtre de redéfinition de mot de passe
            // En fonction de votre implémentation backend

            // Une fois que la réinitialisation est réussie, appeler la fonction pour mettre à jour le mot de passe

        },
        error: function (xhr, status, error) {
            // Gérer les erreurs de réinitialisation du mot de passe
            console.error('Erreur lors de la réinitialisation du mot de passe :', error);
        }
    });
}
document.getElementById('reset-password-btn').addEventListener('click', function (event) {
    event.preventDefault(); // Empêche la soumission du formulaire
    resetPassword();
});
function closeModal() {
    const modalRedPassword = document.getElementById('modal-red-password');
    const overlay = document.getElementById('overlay');
    modalRedPassword.style.display = 'none';
    overlay.style.display = 'none';
}
function updatePassword() {
    // Récupérer les valeurs saisies pour le nouveau mot de passe
    const newPassword = document.getElementById('new-password').value.trim();
    const confirmNewPassword = document.getElementById('confirm-new-password').value.trim();
    const uidb64 = document.getElementById('uidb64').value.trim(); // Get uidb64 from input field
    const token = document.getElementById('token').value.trim(); // Get token from input field

    // Vérifier si les mots de passe correspondent
    if (newPassword !== confirmNewPassword) {
        console.error('Les mots de passe ne correspondent pas.');
        return;
    }

    // Envoyer une requête PATCH au backend pour mettre à jour le mot de passe
    $.ajax({
        url: 'http://127.0.0.1:8000/api/v1/auth/set-new-password/',
        method: 'PATCH',

        data: {
            password: newPassword,
            confirm_password: confirmNewPassword,
            uidb64: uidb64,
            token: token
        },
        success: function (response) {
            // Traiter la réponse du serveur en cas de succès
            console.log('Mot de passe mis à jour avec succès !');
            alert('Votre mot de passe a été modifié avec succès !');
            closeModal();
        },
        error: function (xhr, status, error) {
            // Gérer les erreurs en cas d'échec de la mise à jour du mot de passe
            console.error('Erreur lors de la mise à jour du mot de passe :', error);
        }
    });
}

// Attach event listener to the "Enregistrer" button
document.getElementById('red-password-btn').addEventListener('click', function (event) {
    event.preventDefault(); // Empêche la soumission du formulaire
    updatePassword(); // Call the updatePassword function
});

</script>




</body>
</html>