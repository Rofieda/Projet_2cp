<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width , initial-scale=1.0">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="../styles/BARS.css">

    <script src="../javascript/BARS.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap">
    <link rel="stylesheet" href="../styles/infos2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href='https://fonts.googleapis.com/css?family=Fjalla One' rel='stylesheet'>
    <title>Lmcs Quest</title>
</head>

<body>

    <button class="left-button" onclick="goBack()"><img src="../images/Left1.png"></button>

    <div class="left">
        <div class="left-title">
            <img src="../images/Profile 1.png">
            <p>Informations personnelles</p>
        </div>
        <div class="left-content">
            <button class="photo-button"><img src="../images//blank-profile-picture-973460_1280 copy.png">
            </button>
            <hr class="line">
            <div class="info-container">
                <div class="left-info">
                    <p>Nom :</p>
                    <p>Prénom :</p>
                    <p>Sexe :</p>
                    <p>Etablissement :</p>
                    <p>Diplome :</p>
                    <p>Numéro de téléphone :</p>
                    <p>DPLP lien :</p>
                    <p>Research gate lien :</p>
                    <p>Google scholar lien:</p>
                    <p>ORCIDE :</p>
                    <p>Site web :</p>
                    <p>H-index :</p>
                    <p>Equipe :</p>
                    <p>Qualite :</p>
                    <p>Grade-enseignement :</p>
                    <p>Grade-recherche :</p>
                </div>
                <div class="right-info">
                    <p id="nom_chercheur">Amina</p>
                    <p id="prenom_chercheur">Medabis</p>
                    <p id="sexe_chercheur">Femme</p>
                    <p id="etablissement_chercheur">ESI</p>
                    <p id="diplome_chercheur">XXXXXX</p>
                    <p id="tel_chercheur">XXXXXX</p>
                    <p id="dblp_lien_chercheur"><a href="http://joiskzadjazpod" class="redirect-link">Cliquez ici</a>
                    </p>
                    <p id="research_gate_lien_chercheur"><a href="http://joiskzadjazpod" class="redirect-link">Cliquez
                            ici</a></p>
                    <p id="google_scholar_lien_chercheur"><a href="http://joiskzadjazpod" class="redirect-link">Cliquez
                            ici</a></p>
                            <p id="orcide_chercheur">XXXX XXXX XXXX</p>
                    <p id="site_web_chercheur"><a href="http://joiskzadjazpod" class="redirect-link">Cliquez ici</a></p>
                    
                   
                    <p id="h_index_chercheur">XXX</p>
                    <p id="equipe_chercheur">XXX</p>
                    <p id="qualite_chercheur">XXX</p>
                    <p id="grade_ensignement_chercheur">XXXXXX</p>
                    <p id="grade_recherche_chercheur">XXXXXX</p>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="stat">
    <div class="num-sta" id="pubb" >
            <p id="pubb" class="number">0</p>
            <p >Publications</p>

    </div>
    <div class="num-sta"  id="enc">
            <p  id="enc" class="number">0</p>
            <p >Encadrement</p>

    </div>
    <div class="num-sta" id="pr">
            <p  id="pr" class="number">0</p>
            <p >Projets</p>

    </div>     
</div>
    </div>



    <script src=" https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../javascript/ajout.js"></script>
    <script src="../javascript/BARSS.js"></script>
    <script src="../javascript/notification.js"></script>  

    

    <script>
     document.addEventListener('DOMContentLoaded', function () {
    // Récupérer l'ID du chercheur depuis la session
    const idChercheur = sessionStorage.getItem('id_chercheur');
    if (idChercheur) {
        // Effectuer une requête à l'API pour obtenir les détails du chercheur
        fetch(`http://127.0.0.1:8000/api/chercheur/${idChercheur}/`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                //'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzE0NTgyNTQ2LCJpYXQiOjE3MTQ1ODE5NDYsImp0aSI6Ijc1OTUyMWY1MDRhMjQwNzI5MTI4YmVkZTYzNjg3NDhlIiwidXNlcl9pZCI6MjJ9.xB5IPIzsmmtsJN0QUVyFhXGzvK8CInryPo5tOxZEWtU'
            }
        })
        
            .then(response => response.json())
            .then(data => {
                // Afficher les détails du chercheur dans la page HTML
                document.getElementById('nom_chercheur').innerText = data.nom_chercheur || 'xxxxxxxxx';
                document.getElementById('prenom_chercheur').innerText = data.prenom_chercheur || 'xxxxxxxxx';
                document.getElementById('sexe_chercheur').innerText = data.sexe || 'xxxxxxxxx';
                document.getElementById('etablissement_chercheur').innerText = data.etablissement || 'xxxxxxxxx';
                document.getElementById('diplome_chercheur').innerText = data.diplome || 'xxxxxxxxx';
                document.getElementById('tel_chercheur').innerText = data.tel || 'xxxxxxxxx';
                document.getElementById('dblp_lien_chercheur').innerHTML = `<a href="${data.dblp_lien || '#'}" class="redirect-link">${data.dblp_lien ? 'Cliquez ici' : 'xxxxxxxxx'}</a>`;
                document.getElementById('research_gate_lien_chercheur').innerHTML = `<a href="${data.research_gate_lien || '#'}" class="redirect-link">${data.research_gate_lien ? 'Cliquez ici' : 'xxxxxxxxx'}</a>`;
                document.getElementById('google_scholar_lien_chercheur').innerHTML = `<a href="${data.google_scholar_lien || '#'}" class="redirect-link">${data.google_scholar_lien ? 'Cliquez ici' : 'xxxxxxxxx'}</a>`;
                document.getElementById('orcide_chercheur').innerText = data.orcid || 'xxxxxxxxx';
                document.getElementById('site_web_chercheur').innerHTML = `<a href="${data.site_web || '#'}" class="redirect-link">${data.site_web ? 'Cliquez ici' : 'xxxxxxxxx'}</a>`;
                document.getElementById('h_index_chercheur').innerText = data.h_index || 'xxxxxxxxx';
                document.getElementById('equipe_chercheur').innerText = data.equipe || 'xxxxxxxxx';
                document.getElementById('qualite_chercheur').innerText = data.Qualite || 'xxxxxxxxx';
                document.getElementById('grade_ensignement_chercheur').innerText = data.grade_ensignement || 'xxxxxxxxx';
                document.getElementById('grade_recherche_chercheur').innerText = data.grade_recherche || 'xxxxxxxxx';
            })
            
            .catch(error => console.error('Erreur lors de la récupération des détails du chercheur:', error));
             fetchChercheurDashboard();
    } else {
        console.error('ID du chercheur non trouvé dans la session.');
    }

    // Call fetchChercheurDashboard function
   
});


    </script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Récupérer l'ID du chercheur depuis la session
        const idChercheur = sessionStorage.getItem('id_chercheur');

        fetchChercheurDashboard();

        async function fetchChercheurDashboard() {
            try {
                const response = await fetch(`http://localhost:8000/api/chercheur_dashboardAutre/${idChercheur}/`, {
                    method: 'GET',
                });
                const data = await response.json();
                // Log the fetched data to check if it's coming correctly
                console.log(data);
                // Update HTML content with fetched data
                displayChercheurDashboard(data);
            } catch (error) {
                console.error('Error fetching Chercheur dashboard:', error);
            }
        }

       

    });

    

    function animateCount(element, start, end, duration) {
  let range = Math.abs(end - start);
  let current = start;
  let increment = end > start ? 1 : -1; // adjust increment based on start and end values
  let stepTime = Math.abs(Math.floor(duration / range));
  let timer = setInterval(function() {
    current += increment;
    element.textContent = current;
    if (current === end) {
      clearInterval(timer);
    }
  }, stepTime);
}

    async function fetchChercheurDashboard() {
        try {
            const accessToken = await getAccessToken();
            const response = await fetch('http://localhost:8000/api/chercheur_dashboard/', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + accessToken
                }
            });
            const data = await response.json();
            // Log the fetched data to check if it's coming correctly
            console.log(data);
            // Update HTML content with fetched data
            displayChercheurDashboard(data);
        } catch (error) {
            console.error('Error fetching Chercheur dashboard:', error);
        }
    }

    function displayChercheurDashboard(data) {
        animateCount(document.getElementById('pubb').querySelector('.number'), 0, data.publications_count, 2000);
       
        animateCount(document.getElementById('pr').querySelector('.number'), 0, data.projects_count, 2000);
        if (encValue === 0) {
                encElement.textContent = encValue; 
            } else {
                animateCount(encElement, 0, encValue, 2000);
            };
        document.getElementById('pubb').querySelector('.label').textContent = "Publications";
        document.getElementById('enc').querySelector('.label').textContent = "Encadrements";
        document.getElementById('pr').querySelector('.label').textContent = "Projets";
    }

    // Call the function when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        fetchChercheurDashboard();
    });

</script>


</script>

</body>

</html>